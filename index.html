<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sistema Premium</title>

<style>
:root{
--bg:#f1f5f9;
--card:#ffffff;
--text:#0f172a;
--border:#e2e8f0;
--primary:#2563eb;
--danger:#ef4444;
}

[data-theme="dark"]{
--bg:#0f172a;
--card:#1e293b;
--text:#f1f5f9;
--border:#334155;
--primary:#3b82f6;
--danger:#f87171;
}

*{box-sizing:border-box}
body{margin:0;padding:20px;font-family:Segoe UI;background:var(--bg);color:var(--text);}
.container{max-width:1000px;margin:auto;background:var(--card);padding:20px;border-radius:12px;border:1px solid var(--border);}
h1{text-align:center}
.tabs{display:flex;gap:10px;margin-bottom:20px;}
.tab-btn{flex:1;padding:10px;border:1px solid var(--border);border-radius:8px;background:var(--card);cursor:pointer;}
.tab-btn.active{background:var(--primary);color:white;}
.tab-content{display:none}
.tab-content.active{display:block}
input, textarea{width:100%;padding:8px;margin-bottom:8px;border-radius:6px;border:1px solid var(--border);background:var(--card);color:var(--text);}
button{padding:6px 10px;border:none;border-radius:6px;cursor:pointer;}
.primary{background:var(--primary);color:white}
.danger{background:var(--danger);color:white}
.card{border:1px solid var(--border);padding:10px;border-radius:8px;margin-bottom:8px;}
.actions{display:flex;gap:6px;margin-top:6px;}
.theme-toggle{float:right;cursor:pointer;}
#loginBox{max-width:400px;margin:100px auto;}
.hidden{display:none}
</style>
</head>
<body>

<div id="loginBox" class="container">
<h2>Login</h2>
<input type="email" id="email" placeholder="Email">
<input type="password" id="senha" placeholder="Senha">
<button class="primary" id="btnLogin">Entrar</button>
</div>

<div id="app" class="container hidden">

<button class="theme-toggle" id="themeToggle">ðŸŒ™</button>
<button style="float:left" id="logoutBtn">Sair</button>

<h1>Sistema Premium</h1>

<div class="tabs">
<button class="tab-btn active" data-tab="ramais">Ramais</button>
<button class="tab-btn" data-tab="mensagens">Mensagens</button>
<button class="tab-btn" data-tab="produtos">Produtos</button>
<button class="tab-btn" data-tab="ativos">Ativos</button>
</div>

<div id="ramais" class="tab-content active">
<input id="ramalSetor" placeholder="Setor">
<input id="ramalNumero" placeholder="Ramal">
<button class="primary" id="addRamal">Adicionar</button>
<div id="ramalList"></div>
</div>

<div id="mensagens" class="tab-content">
<textarea id="messageText" placeholder="Mensagem"></textarea>
<button class="primary" id="addMessage">Adicionar</button>
<div id="messageList"></div>
</div>

<div id="produtos" class="tab-content">
<input id="productName" placeholder="Nome">
<input id="productActives" placeholder="Ativos">
<input id="productPosology" placeholder="Posologia">
<button class="primary" id="addProduct">Adicionar</button>
<div id="productList"></div>
</div>

<div id="ativos" class="tab-content">
<input id="activeName" placeholder="Nome do Ativo">
<input id="activeDescription" placeholder="DescriÃ§Ã£o">
<button class="primary" id="addActive">Adicionar</button>
<div id="activeList"></div>
</div>

</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<script>

// âš ï¸ COLOQUE SEUS DADOS CORRETOS AQUI
const supabaseUrl = "https://huqdqwtpxolinyzqxdai.supabase.co"
const supabaseKey = "sb_publishable__MlbqPKxA98ED0uheBLgsw_N0y6KYio"

const supabaseClient = supabase.createClient(supabaseUrl, supabaseKey)

// ===== LOGIN =====

btnLogin.onclick = async () => {
const { error } = await supabaseClient.auth.signInWithPassword({
email: email.value,
password: senha.value
})

if(error){
alert(error.message)
}else{
checkUser()
}
}

// ===== LOGOUT =====

logoutBtn.onclick = async () => {
await supabaseClient.auth.signOut()
location.reload()
}

// ===== VERIFICA SESSÃƒO =====

async function checkUser(){
const { data } = await supabaseClient.auth.getSession()
if(data.session){
loginBox.classList.add("hidden")
app.classList.remove("hidden")
App.init()
}else{
loginBox.classList.remove("hidden")
app.classList.add("hidden")
}
}

checkUser()

// ===== APP =====

const App = {

async init(){
this.bindTabs()
this.bindTheme()
this.bindAddButtons()
this.bindDelegation()
await this.loadAll()
},

async loadAll(){
await this.loadRamais()
await this.loadMessages()
await this.loadProducts()
await this.loadActives()
},

async loadRamais(){
const { data } = await supabaseClient.from("ramais").select("*")
this.renderRamais(data || [])
},

async loadMessages(){
const { data } = await supabaseClient.from("mensagens").select("*")
this.renderMessages(data || [])
},

async loadProducts(){
const { data } = await supabaseClient.from("produtos").select("*")
this.renderProducts(data || [])
},

async loadActives(){
const { data } = await supabaseClient.from("ativos").select("*")
this.renderActives(data || [])
},

bindAddButtons(){

addRamal.onclick=async ()=>{
if(ramalSetor.value && ramalNumero.value){
await supabaseClient.from("ramais").insert({
setor:ramalSetor.value,
numero:ramalNumero.value
})
ramalSetor.value=""
ramalNumero.value=""
this.loadRamais()
}
};

addMessage.onclick=async ()=>{
if(messageText.value){
await supabaseClient.from("mensagens").insert({
texto:messageText.value
})
messageText.value=""
this.loadMessages()
}
};

addProduct.onclick=async ()=>{
if(productName.value && productActives.value && productPosology.value){
await supabaseClient.from("produtos").insert({
name:productName.value,
actives:productActives.value,
posology:productPosology.value
})
productName.value=""
productActives.value=""
productPosology.value=""
this.loadProducts()
}
};

addActive.onclick=async ()=>{
if(activeName.value && activeDescription.value){
await supabaseClient.from("ativos").insert({
name:activeName.value,
description:activeDescription.value
})
activeName.value=""
activeDescription.value=""
this.loadActives()
}
};

},

renderRamais(data){
ramalList.innerHTML=""
data.forEach(item=>{
ramalList.innerHTML+=`
<div class="card">
<strong>${item.setor}</strong> - ${item.numero}
<div class="actions">
<button data-delete="ramal-${item.id}">Excluir</button>
</div>
</div>`
})
},

renderMessages(data){
messageList.innerHTML=""
data.forEach(item=>{
messageList.innerHTML+=`
<div class="card">
${item.texto}
<div class="actions">
<button data-delete="msg-${item.id}">Excluir</button>
</div>
</div>`
})
},

renderProducts(data){
productList.innerHTML=""
data.forEach(item=>{
productList.innerHTML+=`
<div class="card">
<strong>${item.name}</strong>
<div>${item.actives}</div>
<div>${item.posology}</div>
<div class="actions">
<button data-delete="prod-${item.id}">Excluir</button>
</div>
</div>`
})
},

renderActives(data){
activeList.innerHTML=""
data.forEach(item=>{
activeList.innerHTML+=`
<div class="card">
<strong>${item.name}</strong>
<div>${item.description}</div>
<div class="actions">
<button data-delete="active-${item.id}">Excluir</button>
</div>
</div>`
})
},

bindDelegation(){
document.addEventListener("click",async (e)=>{

if(e.target.dataset.delete){
const [type,id]=e.target.dataset.delete.split("-")

if(type==="ramal"){
await supabaseClient.from("ramais").delete().eq("id",id)
this.loadRamais()
}

if(type==="msg"){
await supabaseClient.from("mensagens").delete().eq("id",id)
this.loadMessages()
}

if(type==="prod"){
await supabaseClient.from("produtos").delete().eq("id",id)
this.loadProducts()
}

if(type==="active"){
await supabaseClient.from("ativos").delete().eq("id",id)
this.loadActives()
}
}
})
},

bindTabs(){
document.querySelectorAll(".tab-btn").forEach(btn=>{
btn.onclick=()=>{
document.querySelectorAll(".tab-btn").forEach(b=>b.classList.remove("active"))
document.querySelectorAll(".tab-content").forEach(c=>c.classList.remove("active"))
btn.classList.add("active")
document.getElementById(btn.dataset.tab).classList.add("active")
}
})
},

bindTheme(){
themeToggle.onclick=()=>{
const html=document.documentElement
const dark=html.getAttribute("data-theme")==="dark"
html.setAttribute("data-theme",dark?"light":"dark")
}
}

}

</script>

</body>
</html>
