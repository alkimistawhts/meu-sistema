<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sistema Premium</title>

<style>
:root{
--bg:#f1f5f9;
--card:#ffffff;
--text:#0f172a;
--border:#e2e8f0;
--primary:#2563eb;
--danger:#ef4444;
}

[data-theme="dark"]{
--bg:#0f172a;
--card:#1e293b;
--text:#f1f5f9;
--border:#334155;
--primary:#3b82f6;
--danger:#f87171;
}

*{box-sizing:border-box}
body{margin:0;padding:20px;font-family:Segoe UI;background:var(--bg);color:var(--text);}
.container{max-width:1000px;margin:auto;background:var(--card);padding:20px;border-radius:12px;border:1px solid var(--border);}
h1{text-align:center}
.tabs{display:flex;gap:10px;margin-bottom:20px;}
.tab-btn{flex:1;padding:10px;border:1px solid var(--border);border-radius:8px;background:var(--card);cursor:pointer;}
.tab-btn.active{background:var(--primary);color:white;}
.tab-content{display:none}
.tab-content.active{display:block}
input, textarea{width:100%;padding:8px;margin-bottom:8px;border-radius:6px;border:1px solid var(--border);background:var(--card);color:var(--text);}
button{padding:6px 10px;border:none;border-radius:6px;cursor:pointer;}
.primary{background:var(--primary);color:white}
.danger{background:var(--danger);color:white}
.card{border:1px solid var(--border);padding:10px;border-radius:8px;margin-bottom:8px;}
.actions{display:flex;gap:6px;margin-top:6px;}
.modal{position:fixed;inset:0;background:rgba(0,0,0,.5);display:none;align-items:center;justify-content:center;}
.modal-box{background:var(--card);padding:20px;border-radius:10px;width:320px;}
.modal-actions{display:flex;justify-content:flex-end;gap:8px;margin-top:10px;}
</style>
</head>
<body>

<div id="authBox" class="container" style="max-width:400px;">
  <h2>Login</h2>
  <input id="loginEmail" placeholder="Email">
  <input id="loginPassword" type="password" placeholder="Senha">
  <button class="primary" id="btnLogin">Entrar</button>
</div>
  
<div class="container" id="appContainer" style="display:none;">

<h1>Sistema Premium</h1>

<div class="tabs">
<button class="tab-btn active" data-tab="ramais">Ramais</button>
<button class="tab-btn" data-tab="mensagens">Mensagens</button>
<button class="tab-btn" data-tab="produtos">Produtos</button>
<button class="tab-btn" data-tab="ativos">Ativos</button>
</div>

<div id="ramais" class="tab-content active">
<input id="ramalSetor" placeholder="Setor">
<input id="ramalNumero" placeholder="Ramal">
<button class="primary" id="addRamal">Adicionar</button>
<div id="ramalList"></div>
</div>

<div id="mensagens" class="tab-content">
<textarea id="messageText" placeholder="Mensagem"></textarea>
<button class="primary" id="addMessage">Adicionar</button>
<div id="messageList"></div>
</div>

<div id="produtos" class="tab-content">
<input id="productName" placeholder="Nome">
<input id="productActives" placeholder="Ativos">
<input id="productPosology" placeholder="Posologia">
<button class="primary" id="addProduct">Adicionar</button>
<div id="productList"></div>
</div>

<div id="ativos" class="tab-content">
<input id="activeName" placeholder="Nome do Ativo">
<input id="activeDescription" placeholder="Descrição">
<button class="primary" id="addActive">Adicionar</button>
<div id="activeList"></div>
</div>

</div>

<!-- MODAL -->
<div class="modal" id="modal">
<div class="modal-box">
<h3 id="modalTitle"></h3>
<div id="modalContent"></div>
<div class="modal-actions">
<button class="primary" id="modalConfirm">Confirmar</button>
<button id="modalCancel">Cancelar</button>
</div>
</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<script>

const supabaseUrl = "https://huqdqwtpxolinyzqxdai.supabase.co"
const supabaseKey = "sb_publishable__MlbqPKxA98ED0uheBLgsw_N0y6KYio"
const supabaseClient = supabase.createClient(supabaseUrl, supabaseKey)

const modal = document.getElementById("modal")
const modalTitle = document.getElementById("modalTitle")
const modalContent = document.getElementById("modalContent")
const modalConfirm = document.getElementById("modalConfirm")
const modalCancel = document.getElementById("modalCancel")

let currentAction = null

modalCancel.onclick = () => {
modal.style.display = "none"
currentAction = null
}

modalConfirm.onclick = async () => {
if(currentAction) await currentAction()
}

// ================= AUTH =================

const authBox = document.getElementById("authBox")
const appContainer = document.getElementById("appContainer")
const btnLogin = document.getElementById("btnLogin")

async function checkSession() {
  const { data: { session } } = await supabaseClient.auth.getSession()

  if (session) {
    showApp()
    await App.init()
  } else {
    showLogin()
  }
}

btnLogin.addEventListener("click", async () => {

  const email = document.getElementById("loginEmail").value.trim()
  const password = document.getElementById("loginPassword").value.trim()

  if (!email || !password) {
    alert("Preencha email e senha")
    return
  }

  const { error } = await supabaseClient.auth.signInWithPassword({
    email,
    password
  })

  if (error) {
    alert(error.message)
  } else {
    await checkSession()
  }
})

function showApp() {
  authBox.style.display = "none"
  appContainer.style.display = "block"
}

function showLogin() {
  authBox.style.display = "block"
  appContainer.style.display = "none"
}

const App = {
   async init() {
   this.bindTabs()
   this.bindAdd()
   this.bindDelegation()
   await this.loadAll()
   }
}

async loadAll(){
  await this.load("ramais","ramalList",(data)=>this.renderRamais(data))
  await this.load("mensagens","messageList",(data)=>this.renderMessages(data))
  await this.load("produtos","productList",(data)=>this.renderProducts(data))
  await this.load("ativos","activeList",(data)=>this.renderActives(data))
}

async load(table,listId,render){
const { data,error } = await supabaseClient.from(table).select("*")
if(error){
alert(error.message)
return
}
render(data || [])
},

bindAdd(){

  document.getElementById("addRamal").onclick = () => {
    const setor = document.getElementById("ramalSetor").value
    const numero = document.getElementById("ramalNumero").value

    if(!setor || !numero){
      alert("Preencha todos os campos")
      return
    }

    this.insert("ramais", { setor, numero })
  }

  document.getElementById("addMessage").onclick = () => {
    const texto = document.getElementById("messageText").value
    if(!texto) return
    this.insert("mensagens",{ texto })
  }

  document.getElementById("addProduct").onclick = () => {
    const name = document.getElementById("productName").value
    const actives = document.getElementById("productActives").value
    const posology = document.getElementById("productPosology").value
    this.insert("produtos",{ name, actives, posology })
  }

  document.getElementById("addActive").onclick = () => {
    const name = document.getElementById("activeName").value
    const description = document.getElementById("activeDescription").value
    this.insert("ativos",{ name, description })
  }

},

async insert(table,data){
  const { error } = await supabaseClient.from(table).insert(data)
  if(error){
    alert(error.message)
  } else {
    this.loadAll()
    document.querySelectorAll("input, textarea").forEach(el => el.value = "")
  }
},

renderRamais(data){
  const list = document.getElementById("ramalList")
  list.innerHTML=""

  if(!data || data.length === 0){
    list.innerHTML = "<p>Nenhum ramal cadastrado.</p>"
    return
  }

  data.forEach(i=>{
    list.innerHTML += `
      <div class="card">
        <strong>${i.setor || ""}</strong> - ${i.numero || ""}
        <div class="actions">
          <button data-edit="ramais-${i.id}">Editar</button>
          <button class="danger" data-delete="ramais-${i.id}">Excluir</button>
        </div>
      </div>
    `
  })
},

renderMessages(data){
  const list = document.getElementById("messageList")
  list.innerHTML=""

  data.forEach(i=>{
    if(!i.id) return

    list.innerHTML += `
      <div class="card">
        ${i.texto}
        <div class="actions">
          <button data-edit="mensagens-${i.id}">Editar</button>
          <button class="danger" data-delete="mensagens-${i.id}">Excluir</button>
        </div>
      </div>
    `
  })
},

renderProducts(data){
  const list = document.getElementById("productList")
  list.innerHTML=""

  data.forEach(i=>{
    if(!i.id) return

    list.innerHTML += `
      <div class="card">
        <strong>${i.name}</strong>
        <div>${i.actives}</div>
        <div>${i.posology}</div>
        <div class="actions">
          <button data-edit="produtos-${i.id}">Editar</button>
          <button class="danger" data-delete="produtos-${i.id}">Excluir</button>
        </div>
      </div>
    `
  })
},

renderActives(data){
  const list = document.getElementById("activeList")
  list.innerHTML=""

  data.forEach(i=>{
    if(!i.id) return

    list.innerHTML += `
      <div class="card">
        <strong>${i.name}</strong>
        <div>${i.description}</div>
        <div class="actions">
          <button data-edit="ativos-${i.id}">Editar</button>
          <button class="danger" data-delete="ativos-${i.id}">Excluir</button>
        </div>
      </div>
    `
  })
},

bindDelegation(){
document.addEventListener("click",(e)=>{

const editBtn = e.target.closest("[data-edit]")
const deleteBtn = e.target.closest("[data-delete]")

if(editBtn){
const [table,id]=editBtn.dataset.edit.split("-")
this.openEdit(table,id)
}

if(deleteBtn){
const [table,id]=deleteBtn.dataset.delete.split("-")
this.openDelete(table,id)
}

})
},

async openEdit(table,id){

const numericId = Number(id)
if(!numericId) return

const { data,error } = await supabaseClient
.from(table)
.select("*")
.eq("id", numericId)
.single()

if(error || !data) return

modalTitle.innerText="Editar"
modalContent.innerHTML=""

Object.keys(data).forEach(key=>{
if(key!=="id"){
modalContent.innerHTML+=`<input id="edit_${key}" value="${data[key] || ""}">`
}
})

modal.style.display="flex"

currentAction=async ()=>{
let update={}
Object.keys(data).forEach(key=>{
if(key!=="id"){
update[key]=document.getElementById("edit_"+key).value
}
})
await supabaseClient.from(table).update(update).eq("id", numericId)
modal.style.display="none"
this.loadAll()
}
},

openDelete(table,id){

const numericId = Number(id)
if(!numericId) return

modalTitle.innerText="Confirmar Exclusão"
modalContent.innerHTML="<p>Deseja realmente excluir?</p>"
modal.style.display="flex"

currentAction=async ()=>{
await supabaseClient.from(table).delete().eq("id", numericId)
modal.style.display="none"
this.loadAll()
}
},

bindTabs(){
document.querySelectorAll(".tab-btn").forEach(btn=>{
btn.onclick=()=>{
document.querySelectorAll(".tab-btn").forEach(b=>b.classList.remove("active"))
document.querySelectorAll(".tab-content").forEach(c=>c.classList.remove("active"))
btn.classList.add("active")
document.getElementById(btn.dataset.tab).classList.add("active")
}
})
}

}

checkSession()
  
</script>
</body>
</html>











